<html>
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>memoriata.com</title>
  <meta name="description" content="">

<!-- FONTS -->
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:400,300,200,500,600,900,700' rel='stylesheet' type='text/css'>

<!-- JS -->
<script src="/assets/js/jquery-1.11.2.min.js"></script>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<script src="/assets/js/menutoggle.js"></script>

<script src="/assets/js/tooltip.js"></script>
<script src="/assets/js/AVInfoToggle.js"></script>
<script src="/assets/js/backToTop.js"></script>

  <link rel="stylesheet" href="/css/main.css">

</head>


    <body>
        <div id="container">
            <header id="main-header">
    <a id="logo" href="/index.html">memoriata</a>
    <div id="menubutton">
        &nbsp;
    </div>

    <nav >
        <div class="nav-list">
            <div class="dropdown">
                <a id="music-dropdown">music</a>
                <div class="nav-list" id="music-menu">
                    <a class="external" href="https://dbaker.bandcamp.com/">bandcamp</a>

                    
                        <a href="/music/audio">audio</a>
                    

                    
                        <a href="/music/video">video</a>
                    

                    
                        <a href="/music/mechanisms">mechanisms</a>
                    

                    
                        <a href="/music/scores">scores</a>
                    

                </div>
            </div>

            <div class="dropdown">
                <a id="geekery-dropdown">geekery</a>
                <div class="nav-list" id="geek-menu">
                    
                        <a href="/bots.html">twitter bots</a>
                    

                    <a class="external" href="/portfolio/botlang">botlang</a>
                    <a class="external" href="/portfolio/artgen">generated art</a>
                    <a class="external" href="https://github.com/d-baker/NaNoGenMo-2014">nanogenmo 2014</a>
                </div>
            </div>

            
                <a href="/blog">blog</a>
            

            
                <a href="/links.html">links</a>
            

        </div>
    </nav>

</header>




            <main>
            <h1>contact me</h1>

<!--
=================================== PHP =======================================
-->

<?php

    if ( isset($_POST["name"]) && isset($_POST["email"]) && isset($_POST["subject"])
        && isset($_POST["message"]) ) {

        validateName();
        validateEmail();
        validateSubject();
        validateMessage();
        validateRobot();

        if ( validateName() && validateEmail() && validateSubject() && validateMessage() && validateRobot() ) {
            echo "<div class='notification success'>Thank you! Your message has been sent.</div>";


            require_once "Mail.php";
            include "smtp-conf.php";

            $name    = filter_var($_POST["name"], FILTER_SANITIZE_SPECIAL_CHARS);
            $fromEmail   = filter_var($_POST["email"], FILTER_SANITIZE_SPECIAL_CHARS);
            $subject = filter_var($_POST["subject"], FILTER_SANITIZE_SPECIAL_CHARS);
            $message = filter_var($_POST["message"], FILTER_SANITIZE_SPECIAL_CHARS);

            $toEmail      = "dorotheabaker@gmail.com";

            //TODO argh
            // see: https://productforums.google.com/forum/#!topic/apps/l0bjS-c_5o0
            // http://www.pear-forum.org/post-4935.html
            // I don't know where to find the PEAR source

            //$host = "ssl://smtp.gmail.com";
            $host = "smtp.gmail.com";
            $port = "465";
            $username = $un;
            $password = $pw;

            $headers = array (
                'From' => $fromEmail,
                'To' => $toEmail,
                'Subject' => $subject
            );

            $smtp = Mail::factory('smtp',
              array (
                'host' => $host,
                'auth' => true,
                'username' => $username,
                'password' => $password
              )
            );

            $smtp->SMTPAuth   = true;
            $smpt->SMTPSecure = "tls";

            $mail = $smtp->send($toEmail, $headers, $message);

            // TODO
            if (PEAR::isError($mail)) {
                echo("<p>" . $mail->getMessage() . "</p>");
            } else {
                echo("<p>Message successfully sent!</p>");
            }

        } else {
            echo "<div class='notification failure'>Sorry, couldn't send your message - please check for errors below</div>";
        }

    }

    function validateName() {
        if ($_POST["name"] === "") {
            $_SESSION["error"]["nameError"] = "This field is required!";
            return false;
        }
        return true;
    }

    function validateEmail() {
        if ($_POST["email"] === "") {
            $_SESSION["error"]["emailError"] = "This field is required!";
            return false;
        } else if (! filter_var($_POST["email"], FILTER_VALIDATE_EMAIL) ) {
            $_SESSION["error"]["emailError"] = "Invalid email address";
            return false;
        }
        return true;
    }

    function validateSubject() {
        if ($_POST["subject"] === "") {
            $_SESSION["error"]["subjectError"] = "This field is required!";
            return false;
        }

        return true;
    }

    function validateMessage() {
        if ($_POST["message"] === "") {
            $_SESSION["error"]["messageError"] = "This field is required!";
            return false;
        }

        return true;
    }

    function validateRobot() {
        if ($_POST["antirobot"] === "") {
            $_SESSION["error"]["robotError"] = "This field is required!";
            return false;
        }

        $robotInput = filter_var($_POST["antirobot"], FILTER_SANITIZE_STRIPPED);

        if ( intval($robotInput) != 5 ) {
            $_SESSION["error"]["robotError"] = "Excuse me, are you a robot?";
            return false;
        }

        return true;
    }

?>

<!--
================================== FORM ======================================
-->

<form action="contact.php" method="post">

    <div class="formfield">

        <label for="name" class="required">Name</label>

        <input type="text" name="name"
            <?php if (isset ($_SESSION["error"]["nameError"])) echo "class='invalid'"; ?>
        />

        <p class="error">
            <?php
                if (isset ($_SESSION["error"]["nameError"])) {
                    echo $_SESSION["error"]["nameError"];
                }
            ?>
        </p>

    </div>

    <div class="formfield">
        <label for="email" class="required">Email address</label>

        <input type="text" name="email"
            <?php if (isset ($_SESSION["error"]["emailError"])) echo "class='invalid'"; ?>
        />

        <p class="error">
            <?php
                if (isset ($_SESSION["error"]["emailError"])) {
                    echo $_SESSION["error"]["emailError"];
                }
            ?>
        </p>

    </div>

    <div class="formfield">
        <label for="subject" class="required">Subject</label>

        <input type="text" name="subject"
            <?php if (isset ($_SESSION["error"]["subjectError"])) echo "class='invalid'"; ?>
        />

        <p class="error">
            <?php
                if (isset ($_SESSION["error"]["subjectError"])) {
                    echo $_SESSION["error"]["subjectError"];
                }
            ?>
        </p>

    </div>

    <div class="formfield">
        <label for="message" class="required">Message</label>

        <textarea name="message"
            <?php if (isset ($_SESSION["error"]["messageError"])) echo "class='invalid'"; ?>
        ></textarea>

        <p class="error">
            <?php
                if (isset ($_SESSION["error"]["messageError"])) {
                    echo $_SESSION["error"]["messageError"];
                }
            ?>
        </p>

    </div>

    <div id="antirobot" class="formfield">
        <label for="antirobot" class="required">Confirm you're not a robot</label>
        <p class="test">2 + 3 = </p>

        <input type="text" name="antirobot"
            <?php if (isset ($_SESSION["error"]["robotError"])) echo "class='invalid'"; ?>
        />

        <p class="error">
            <?php
                if (isset ($_SESSION["error"]["robotError"])) {
                    echo $_SESSION["error"]["robotError"];
                }
            ?>
        </p>

    </div>

    <input type="submit" id="submit" value="Send"/>
</form>

            </main>

            <footer>
    <p class="sitelink"> <a href="https://twitter.com/dbaker_h">@dbaker_h</a> | <a href="http://nightmare.website">nightmare.website</a> </p>

</footer>

        </div>
    </body>

</html>
